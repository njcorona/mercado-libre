---
title: "iPh8PlCase"
author: "NicolasCorona"
date: "6/16/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
suppressWarnings(suppressMessages(library(tidyverse)))
suppressWarnings(suppressMessages(library(httr)))
suppressWarnings(suppressMessages(library(stringr)))
suppressWarnings(suppressMessages(library(rvest)))
suppressWarnings(suppressMessages(library(magrittr)))
suppressWarnings(suppressMessages(library(future)))
```

```{r}
date <- "6_16_"
arg_p <- read_csv(date %>% paste("iPh8PlCase_Prod_Arg.csv", sep = ""), col_names = TRUE)
bra_p <- read_csv(date %>% paste("iPh8PlCase_Prod_Bra.csv", sep = ""), col_names = TRUE)
chi_p <- read_csv(date %>% paste("iPh8PlCase_Prod_Chi.csv", sep = ""), col_names = TRUE)
# col_p <- read_csv(date %>% paste("iPh8PlCase_Prod_Col.csv", sep = ""), col_names = TRUE)
# mex_p <- read_csv(date %>% paste("iPh8PlCase_Prod_Mex.csv", sep = ""), col_names = TRUE)
# per_p <- read_csv(date %>% paste("iPh8PlCase_Prod_Per.csv", sep = ""), col_names = TRUE)
# uru_p <- read_csv(date %>% paste("iPh8PlCase_Prod_Uru.csv", sep = ""), col_names = TRUE)
arg_s <- read_csv(date %>% paste("iPh8PlCase_Sell_Arg.csv", sep = ""), col_names = TRUE)
bra_s <- read_csv(date %>% paste("iPh8PlCase_Sell_Bra.csv", sep = ""), col_names = TRUE)
chi_s <- read_csv(date %>% paste("iPh8PlCase_Sell_Chi.csv", sep = ""), col_names = TRUE)
# col_s <- read_csv(date %>% paste("iPh8PlCase_Sell_Col.csv", sep = ""), col_names = TRUE)
# mex_s <- read_csv(date %>% paste("iPh8PlCase_Sell_Mex.csv", sep = ""), col_names = TRUE)
# per_s <- read_csv(date %>% paste("iPh8PlCase_Sell_Per.csv", sep = ""), col_names = TRUE)
# uru_s <- read_csv(date %>% paste("iPh8PlCase_Sell_Uru.csv", sep = ""), col_names = TRUE)

arg_p$country <- "ARG"
bra_p$country <- "BRA"
chi_p$country <- "CHI"
# col_p$country <- "COL"
# mex_p$country <- "MEX"
# per_p$country <- "PER"
# uru_p$country <- "URU"
arg_s$country <- "ARG"
bra_s$country <- "BRA"
chi_s$country <- "CHI"
# col_s$country <- "COL"
# mex_s$country <- "MEX"
# per_s$country <- "PER"
# uru_s$country <- "URU"

prod <- bind_rows(arg_p, bra_p, chi_p)#, col_p, mex_p, per_p, uru_p)
sell <- bind_rows(arg_s, bra_s, chi_s)#, col_s, mex_s, per_s, uru_s)

units_of_time_operating_values <- sell$units_of_time_operating[!duplicated(sell$units_of_time_operating)]
sell$units_of_time_operating <- sapply(sell$units_of_time_operating, function(x) { return ( if (is.na(x)) { which(is.na(units_of_time_operating_values)) } else { which(x == units_of_time_operating_values) }) })
# Here
timeframe_of_amt_sold_values <- sell$timeframe_of_amt_sold[!duplicated(sell$timeframe_of_amt_sold)]
sell$timeframe_of_amt_sold <- sapply(sell$timeframe_of_amt_sold, function(x) { return ( if (is.na(x)) { which(is.na(timeframe_of_amt_sold_values)) } else { which(x == timeframe_of_amt_sold_values) }) })

arrival_time_values <- prod$arrival_time[!duplicated(prod$arrival_time)]
prod$arrival_time <- sapply(prod$arrival_time, function(x) { return ( if (is.na(x)) { which(is.na(arrival_time_values)) } else { which(x == arrival_time_values) }) })

shipping_values <- prod$shipping[!duplicated(prod$shipping)]
prod$shipping <- sapply(prod$shipping, function(x) { return ( if (is.na(x)) { which(is.na(shipping_values)) } else { which(x == shipping_values) }) })

free_return_values <- prod$free_return[!duplicated(prod$free_return)]
prod$free_return <- sapply(prod$free_return, function(x) { return ( if (is.na(x)) { which(is.na(free_return_values)) } else { which(x == free_return_values) }) })

free_return_info_values <- prod$free_return_info[!duplicated(prod$free_return_info)]
prod$free_return_info <- sapply(prod$free_return_info, function(x) { return ( if (is.na(x)) { which(is.na(free_return_info_values)) } else { which(x == free_return_info_values) }) })

write_csv(prod, date %>% paste("iPh8PlCase_Prod.csv", sep = ""))
write_csv(sell, date %>% paste("iPh8PlCase_Sell.csv", sep = ""))

# I may want to remove this particular bit of cleaning until I bring all of the countries together.
list <- list(units_of_time_operating_values, timeframe_of_amt_sold_values, arrival_time_values, shipping_values, free_return_values, free_return_info_values)
max <- max( sapply(list, function(x) { length(x) }) )
list <- lapply(list, function(x) {
  if (length(x) < max) {
    orig_l <- length(x)
    x <- rep(x, length.out = max)
    x[c((orig_l + 1):max)] <- "" # As opposed to " ".
    return (x)
  }
  return (x)
  
})

data_legend <- tibble(value = c(1:max), units_of_time_operating_values = list[[1]], timeframe_of_amt_sold_values = list[[2]], arrival_time_values = list[[3]], shipping_values = list[[4]], free_return_values = list[[5]], free_return_info_values = list[[6]])
write_csv(data_legend, date %>% paste("iPh8PlCase_Legend.csv", sep = ""))

```

